name: jianshu
display_name: 简书
icon: jianshu.svg
homepage: https://www.jianshu.com

capabilities:
  - article
  - draft
  - image_upload
  - categories

auth:
  check:
    request:
      url: https://www.jianshu.com/author/api/v1/user
      method: GET
    response:
      success: "$.id != null"
      extract:
        user_id: "$.id"
        username: "$.nickname"
        avatar: "$.avatar"

endpoints:
  get_categories:
    request:
      url: https://www.jianshu.com/author/api/v1/notebooks
      method: GET
    response:
      extract:
        categories: "$[*]"

  create_draft:
    request:
      url: https://www.jianshu.com/author/api/v1/notes
      method: POST
      headers:
        Content-Type: application/json
      body:
        notebook_id: "{{category_id}}"
        title: "{{article.title}}"
        content: ""
    response:
      success: "$.id != null"
      extract:
        draft_id: "$.id"

  update_draft:
    request:
      url: "https://www.jianshu.com/author/api/v1/notes/{{draft_id}}"
      method: PUT
      headers:
        Content-Type: application/json
      body:
        title: "{{article.title}}"
        content: "{{article.content}}"
    response:
      success: "$.id != null"

  publish:
    request:
      url: "https://www.jianshu.com/author/api/v1/notes/{{draft_id}}/publicize"
      method: POST
    response:
      success: "$.id != null"
      extract:
        post_id: "$.id"
        post_url: "$.url"

  upload_image:
    request:
      url: https://www.jianshu.com/upload_images/token
      method: GET
    response:
      extract:
        upload_token: "$.token"
        upload_url: "$.url"
