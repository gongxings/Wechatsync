name: juejin
display_name: 掘金
icon: juejin.svg
homepage: https://juejin.cn

capabilities:
  - article
  - draft
  - image_upload
  - categories
  - tags
  - cover

auth:
  check:
    request:
      url: https://api.juejin.cn/user_api/v1/user/get
      method: GET
    response:
      success: "$.data.user_id != null"
      extract:
        user_id: "$.data.user_id"
        username: "$.data.user_name"
        avatar: "$.data.avatar_large"

endpoints:
  get_categories:
    request:
      url: https://api.juejin.cn/tag_api/v1/query_category_briefs
      method: GET
    response:
      extract:
        categories: "$.data[*]"

  create_draft:
    request:
      url: https://api.juejin.cn/content_api/v1/article_draft/create
      method: POST
      headers:
        Content-Type: application/json
      body:
        title: "{{article.title}}"
        brief_content: "{{article.summary}}"
        cover_image: "{{article.cover}}"
        mark_content: "{{article.content}}"
    response:
      success: "$.data.id != null"
      extract:
        draft_id: "$.data.id"

  update_draft:
    request:
      url: https://api.juejin.cn/content_api/v1/article_draft/update
      method: POST
      headers:
        Content-Type: application/json
      body:
        id: "{{draft_id}}"
        title: "{{article.title}}"
        brief_content: "{{article.summary}}"
        mark_content: "{{article.content}}"
    response:
      success: "$.err_no == 0"

  publish:
    request:
      url: https://api.juejin.cn/content_api/v1/article/publish
      method: POST
      headers:
        Content-Type: application/json
      body:
        draft_id: "{{draft_id}}"
        sync_to_org: false
    response:
      success: "$.data.article_id != null"
      extract:
        post_id: "$.data.article_id"

  upload_image:
    request:
      url: https://api.juejin.cn/content_api/v1/upload/image
      method: POST
      content_type: multipart
      body:
        file: "{{image}}"
    response:
      extract:
        image_url: "$.data.url"
