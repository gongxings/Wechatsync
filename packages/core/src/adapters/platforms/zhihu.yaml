name: zhihu
display_name: 知乎
icon: zhihu.svg
homepage: https://www.zhihu.com

capabilities:
  - article
  - draft
  - image_upload
  - tags
  - cover

auth:
  check:
    request:
      url: https://www.zhihu.com/api/v4/me
      method: GET
    response:
      success: "$.id != null"
      extract:
        user_id: "$.id"
        username: "$.name"
        avatar: "$.avatar_url"

endpoints:
  create_draft:
    request:
      url: https://www.zhihu.com/api/v4/drafts
      method: POST
      headers:
        Content-Type: application/json
      body:
        title: "{{article.title}}"
        content: ""
        delta_time: 0
    response:
      success: "$.id != null"
      extract:
        draft_id: "$.id"

  update_draft:
    request:
      url: "https://www.zhihu.com/api/v4/drafts/{{draft_id}}"
      method: PATCH
      headers:
        Content-Type: application/json
      body:
        title: "{{article.title}}"
        content: "{{article.content}}"
    response:
      success: "$.id != null"

  publish:
    request:
      url: "https://www.zhihu.com/api/v4/drafts/{{draft_id}}/publish"
      method: PUT
      headers:
        Content-Type: application/json
      body:
        commentPermission: "anyone"
    response:
      success: "$.id != null"
      extract:
        post_id: "$.id"
        post_url: "$.url"

  upload_image:
    request:
      url: https://www.zhihu.com/api/v4/images
      method: POST
      content_type: multipart
      body:
        file: "{{image}}"
    response:
      extract:
        image_url: "$.url"

header_rules:
  - url_filter: "*://www.zhihu.com/api/*"
    headers:
      x-requested-with: fetch

custom_logic:
  content_transform: ./_custom/zhihu.transform.ts
